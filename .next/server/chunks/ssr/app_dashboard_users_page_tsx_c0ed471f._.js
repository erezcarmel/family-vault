module.exports=[60788,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69240),e=a.i(3650),f=a.i(21929),g=a.i(68979);function h(){let[a,h]=(0,c.useState)([]),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)({email:"",role:"member"}),[y,z]=(0,c.useState)({email:"",role:"member"}),[A,B]=(0,c.useState)(null),C=(0,d.createClient)(),D=[{value:"admin",label:"Admin",icon:f.faShieldAlt,description:"Can manage the family account"},{value:"editor",label:"Editor",icon:f.faUserEdit,description:"Can update account data, cannot manage members"},{value:"member",label:"Member",icon:f.faUser,description:"Can only view the data"}];(0,c.useEffect)(()=>{E()},[]);let E=async()=>{try{let{data:{user:a}}=await C.auth.getUser();if(a){let a=await (0,g.getFamilyId)(C);if(console.log("Users page - Family ID:",a),a){l(a);let b=await (0,g.getUserRole)(C,a);console.log("Users page - User role:",b),n(b),"admin"===b?(await F(a),await G(a)):B(`You do not have permission to manage users. Your role: ${b||"none"}`)}else B("No family found. Please complete onboarding first.")}}catch(a){console.error("Error loading data:",a),B(`Failed to load user data: ${a instanceof Error?a.message:"Unknown error"}`)}finally{p(!1)}},F=async a=>{let{data:b,error:c}=await C.from("family_users").select("*").eq("family_id",a).order("created_at",{ascending:!1});if(c){console.error("Error loading users:",c),B("Failed to load users");return}h(await Promise.all((b||[]).map(async a=>{let b=await fetch(`/api/get-user-email?userId=${a.user_id}`),c=await b.json();return{...a,email:c.email||"Unknown"}})))},G=async a=>{let b=await fetch(`/api/invitations?familyId=${a}`),c=await b.json();c.success&&j(c.data||[])},H=async a=>{if(a.preventDefault(),B(null),k)try{let a=await fetch("/api/invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y.email,role:y.role,familyId:k})}),b=await a.json();if(!a.ok)throw Error(b.message||b.error||"Failed to create invitation");await G(k),z({email:"",role:"member"}),t(!1)}catch(a){console.error("Error creating invitation:",a),B(a.message||"Failed to create invitation")}},I=async a=>{if(confirm("Are you sure you want to cancel this invitation?"))try{if(!(await fetch(`/api/invitations?id=${a}`,{method:"DELETE"})).ok)throw Error("Failed to delete invitation");k&&await G(k)}catch(a){console.error("Error deleting invitation:",a),alert("Failed to cancel invitation")}},J=async a=>{if(a.preventDefault(),B(null),k)try{if(u){let{error:a}=await C.from("family_users").update({role:w.role}).eq("id",u.id);if(a)throw a}else{let a=await fetch("/api/add-family-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:w.email,role:w.role,familyId:k})}),b=await a.json();if(!a.ok)throw Error(b.message||b.error||"Failed to add user")}await F(k),x({email:"",role:"member"}),r(!1),v(null)}catch(a){console.error("Error saving user:",a),B(a.message||"Failed to save user")}},K=async a=>{if(confirm("Are you sure you want to remove this user from your family?"))try{let{error:b}=await C.from("family_users").delete().eq("id",a);if(b)throw b;k&&await F(k)}catch(a){console.error("Error deleting user:",a),alert("Failed to remove user")}},L=a=>{let b=D.find(b=>b.value===a);return b?.label||a};return o?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):"admin"!==m?(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsxs)("div",{className:"card text-center py-12",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faShieldAlt,className:"text-6xl text-gray-300 mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),(0,b.jsx)("p",{className:"text-gray-600",children:"You need admin permissions to manage users."})]})}):(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faUsers,className:"text-white text-xl"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Manage family members and their permissions"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("button",{onClick:()=>{t(!s),r(!1),z({email:"",role:"member"}),B(null)},className:"btn-secondary",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faEnvelope,className:"mr-2"}),"Invite User"]}),(0,b.jsxs)("button",{onClick:()=>{r(!q),t(!1),v(null),x({email:"",role:"member"}),B(null)},className:"btn-primary",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faPlus,className:"mr-2"}),"Add User"]})]})]}),A&&(0,b.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:A}),s&&(0,b.jsxs)("div",{className:"card mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Invite Family Member"}),(0,b.jsxs)("form",{onSubmit:H,className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,b.jsx)("input",{type:"email",value:y.email,onChange:a=>z({...y,email:a.target.value}),className:"input-field",placeholder:"user@example.com",required:!0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"They will receive an invitation link to sign up"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,b.jsx)("select",{value:y.role,onChange:a=>z({...y,role:a.target.value}),className:"input-field",required:!0,children:D.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:D.find(a=>a.value===y.role)?.description})]})]}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{t(!1),z({email:"",role:"member"}),B(null)},className:"btn-secondary",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",className:"btn-primary",children:"Send Invitation"})]})]})]}),q&&(0,b.jsxs)("div",{className:"card mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:u?"Edit User Role":"Add Family Member"}),(0,b.jsxs)("form",{onSubmit:J,className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,b.jsx)("input",{type:"email",value:w.email,onChange:a=>x({...w,email:a.target.value}),className:"input-field",placeholder:"user@example.com",required:!0,disabled:!!u}),u&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,b.jsx)("select",{value:w.role,onChange:a=>x({...w,role:a.target.value}),className:"input-field",required:!0,children:D.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:D.find(a=>a.value===w.role)?.description})]})]}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{r(!1),v(null),x({email:"",role:"member"}),B(null)},className:"btn-secondary",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",className:"btn-primary",children:u?"Update Role":"Add User"})]})]})]}),i.length>0&&(0,b.jsxs)("div",{className:"card mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pending Invitations"}),(0,b.jsx)("div",{className:"space-y-3",children:i.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:"pending"===a.status?f.faClock:"accepted"===a.status?f.faCheckCircle:f.faTimesCircle,className:`text-lg ${"pending"===a.status?"text-yellow-600":"accepted"===a.status?"text-green-600":"text-gray-400"}`}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.email}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Role: ",L(a.role)," â€¢","pending"===a.status?(0,b.jsx)("span",{className:"text-yellow-600",children:" Pending"}):"accepted"===a.status?(0,b.jsx)("span",{className:"text-green-600",children:" Accepted"}):(0,b.jsxs)("span",{className:"text-gray-400",children:[" ",a.status]})]}),"pending"===a.status&&(0,b.jsx)("button",{onClick:()=>{var b;let c,d;return b=a.token,c=window.location.origin,d=`${c}/auth/signup?token=${b}`,void(navigator.clipboard.writeText(d),alert("Invitation link copied to clipboard!"))},className:"text-xs text-indigo-600 hover:text-indigo-700 mt-1",children:"Copy invitation link"})]})]})}),"pending"===a.status&&(0,b.jsx)("button",{onClick:()=>I(a.id),className:"text-red-600 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Cancel invitation",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faTrash})})]},a.id))})]}),0===a.length?(0,b.jsxs)("div",{className:"text-center py-12 card",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faUsers,className:"text-6xl text-gray-300 mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Users Yet"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Add family members to share access"}),(0,b.jsxs)("button",{onClick:()=>r(!0),className:"btn-primary",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faPlus,className:"mr-2"}),"Add Your First User"]})]}):(0,b.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(c=>{var d;let g;return(0,b.jsx)("div",{className:"card hover:shadow-lg transition-shadow",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:(d=c.role,g=D.find(a=>a.value===d),g?.icon||f.faUser),className:"text-white text-xl"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:c.email}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:L(c.role)})]})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:D.find(a=>a.value===c.role)?.description})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)("button",{onClick:()=>{v(c),x({email:c.email||"",role:c.role}),r(!0)},className:"text-indigo-600 hover:text-indigo-700 p-2 rounded-lg hover:bg-indigo-50 transition-colors",title:"Edit role",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faEdit})}),a.length>1&&(0,b.jsx)("button",{onClick:()=>K(c.id),className:"text-red-600 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Remove user",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faTrash})})]})]})},c.id)})})]})}a.s(["default",()=>h,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=app_dashboard_users_page_tsx_c0ed471f._.js.map