module.exports=[93723,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69240),e=a.i(3650),f=a.i(21929);function g({isOpen:a,onClose:g,onSuccess:h,familyId:i,document:j}){let[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(0),u=(0,c.useRef)(null),v=(0,d.createClient)();(0,c.useEffect)(()=>{j?(l(j.title),n(j.description||""),p(null)):w()},[j,a]);let w=()=>{l(""),n(""),p(null),t(0),u.current&&(u.current.value="")},x=async a=>{if(a.preventDefault(),!i)return void alert("Family ID not found");if(!k.trim())return void alert("Please enter a title");if(j)return void await y();if(!o)return void alert("Please select a file to upload");r(!0),t(0);try{let{data:{user:a}}=await v.auth.getUser();if(!a)throw Error("User not found");let b=o.name.split(".").pop(),c=`${Date.now()}-${Math.random().toString(36).substring(2)}.${b}`,d=`${a.id}/${c}`,{error:e}=await v.storage.from("family-documents").upload(d,o,{cacheControl:"3600",upsert:!1});if(e)throw e;t(50);let{error:f}=await v.from("documents").insert({family_id:i,title:k.trim(),description:m.trim()||null,file_name:o.name,file_path:d,file_size:o.size,file_type:o.type||"application/octet-stream"});if(f)throw await v.storage.from("family-documents").remove([d]),f;t(100),h(),w()}catch(a){console.error("Error uploading document:",a),alert(`Failed to upload document: ${a.message}`)}finally{r(!1),t(0)}},y=async()=>{if(j){r(!0);try{let{error:a}=await v.from("documents").update({title:k.trim(),description:m.trim()||null,updated_at:new Date().toISOString()}).eq("id",j.id);if(a)throw a;h(),w()}catch(a){console.error("Error updating document:",a),alert(`Failed to update document: ${a.message}`)}finally{r(!1)}}};return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-white/75 z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,b.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:j?"Edit Document Details":"Upload Document"}),(0,b.jsx)("button",{onClick:g,disabled:q,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faTimes,className:"text-xl"})})]}),(0,b.jsxs)("form",{onSubmit:x,className:"p-6 space-y-6",children:[!j&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File *"}),(0,b.jsx)("input",{ref:u,type:"file",onChange:a=>{let b=a.target.files?.[0];if(b){if(b.size>0x3200000)return void alert("File size must be less than 50MB");p(b)}},className:"hidden",disabled:q}),o?(0,b.jsx)("div",{className:"border-2 border-indigo-200 bg-indigo-50 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faFile,className:"text-indigo-600 text-2xl"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:o.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:(a=>{if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,b)*100)/100+" "+["Bytes","KB","MB","GB"][b]})(o.size)})]})]}),!q&&(0,b.jsx)("button",{type:"button",onClick:()=>{p(null),u.current&&(u.current.value="")},className:"text-red-600 hover:text-red-700",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faTimes})})]})}):(0,b.jsxs)("button",{type:"button",onClick:()=>u.current?.click(),disabled:q,className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 hover:bg-indigo-50 transition-colors disabled:opacity-50",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faUpload,className:"text-4xl text-gray-400 mb-3"}),(0,b.jsx)("p",{className:"text-gray-700 font-medium",children:"Click to select a file"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Max file size: 50MB"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),(0,b.jsx)("input",{type:"text",value:k,onChange:a=>l(a.target.value),className:"input-field",placeholder:"e.g., Passport Copy, House Insurance Policy",required:!0,disabled:q,maxLength:200}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[k.length,"/200 characters"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),(0,b.jsx)("textarea",{value:m,onChange:a=>n(a.target.value),className:"input-field min-h-[100px]",placeholder:"Add any additional details or notes about this document...",disabled:q,maxLength:1e3,rows:4}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[m.length,"/1000 characters"]})]}),q&&(0,b.jsxs)("div",{className:"bg-indigo-50 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-indigo-900",children:j?"Updating...":"Uploading..."}),(0,b.jsxs)("span",{className:"text-sm text-indigo-700",children:[s,"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-indigo-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[(0,b.jsx)("button",{type:"button",onClick:g,disabled:q,className:"flex-1 btn-secondary disabled:opacity-50",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",disabled:q||!k.trim()||!j&&!o,className:"flex-1 btn-primary disabled:opacity-50",children:q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faSpinner,className:"mr-2 animate-spin"}),j?"Updating...":"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:j?f.faTimes:f.faUpload,className:"mr-2"}),j?"Update Details":"Upload Document"]})})]})]})]})}):null}function h(){let[a,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),s=(0,d.createClient)();(0,c.useEffect)(()=>{t()},[]);let t=async()=>{try{let{data:{user:a}}=await s.auth.getUser();if(a){let{data:b}=await s.from("families").select("id").eq("user_id",a.id).single();b&&(j(b.id),await u(b.id))}}catch(a){console.error("Error loading data:",a)}finally{l(!1)}},u=async a=>{let{data:b,error:c}=await s.from("documents").select("*").eq("family_id",a).order("created_at",{ascending:!1});c?console.error("Error loading documents:",c):h(b||[])},v=async a=>{r(a.id);try{let{data:b,error:c}=await s.storage.from("family-documents").download(a.file_path);if(c)throw c;let d=window.URL.createObjectURL(b),e=document.createElement("a");e.href=d,e.download=a.file_name,document.body.appendChild(e),e.click(),window.URL.revokeObjectURL(d),document.body.removeChild(e)}catch(a){console.error("Error downloading document:",a),alert("Failed to download document. Please try again.")}finally{r(null)}},w=async a=>{if(confirm(`Are you sure you want to delete "${a.title}"?`))try{let{error:b}=await s.storage.from("family-documents").remove([a.file_path]);if(b)throw b;let{error:c}=await s.from("documents").delete().eq("id",a.id);if(c)throw c;i&&await u(i)}catch(a){console.error("Error deleting document:",a),alert("Failed to delete document. Please try again.")}},x=()=>{p(null),n(!0)},y=()=>{n(!1),p(null)};return k?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faFileAlt,className:"text-white text-xl"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Documents"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Upload and manage your important documents"})]})]}),(0,b.jsxs)("button",{onClick:x,className:"btn-primary",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faPlus,className:"mr-2"}),"Upload Document"]})]}),0===a.length?(0,b.jsxs)("div",{className:"text-center py-12 card",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faFileAlt,className:"text-6xl text-gray-300 mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Documents Yet"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Start by uploading your first document"}),(0,b.jsxs)("button",{onClick:x,className:"btn-primary",children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faPlus,className:"mr-2"}),"Upload Your First Document"]})]}):(0,b.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(a=>{var c;return(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"text-3xl",children:(c=a.file_type).startsWith("image/")?"ðŸ–¼ï¸":c.startsWith("video/")?"ðŸŽ¥":c.startsWith("audio/")?"ðŸŽµ":c.includes("pdf")?"ðŸ“„":c.includes("word")||c.includes("document")?"ðŸ“":c.includes("excel")||c.includes("spreadsheet")?"ðŸ“Š":c.includes("powerpoint")||c.includes("presentation")?"ðŸ“½ï¸":c.includes("zip")||c.includes("rar")||c.includes("compressed")?"ðŸ“¦":"ðŸ“„"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:(a=>{if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,b)*100)/100+" "+["Bytes","KB","MB","GB"][b]})(a.file_size)})]})]})}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:a.description}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 truncate",title:a.file_name,children:a.file_name}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(a.created_at).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-gray-100",children:[(0,b.jsx)("button",{onClick:()=>v(a),disabled:q===a.id,className:"flex-1 text-sm px-3 py-2 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:q===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faSpinner,className:"animate-spin"}),(0,b.jsx)("span",{children:"Downloading..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faDownload}),(0,b.jsx)("span",{children:"Download"})]})}),(0,b.jsx)("button",{onClick:()=>{p(a),n(!0)},className:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",title:"Edit details",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faEdit})}),(0,b.jsx)("button",{onClick:()=>w(a),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",title:"Delete",children:(0,b.jsx)(e.FontAwesomeIcon,{icon:f.faTrash})})]})]},a.id)})}),(0,b.jsx)(g,{isOpen:m,onClose:y,onSuccess:()=>{i&&u(i),y()},familyId:i,document:o})]})}a.s(["default",()=>h,"dynamic",0,"force-dynamic"],93723)}];

//# sourceMappingURL=app_dashboard_documents_page_tsx_ce205ee2._.js.map