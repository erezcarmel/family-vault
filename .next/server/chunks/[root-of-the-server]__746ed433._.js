module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},91846,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),c=e.i(66012),m=e.i(70101),h=e.i(26937),x=e.i(10372),f=e.i(93695);e.i(52474);var v=e.i(5232),g=e.i(89660),y=e.i(89171);async function R({to:e,subject:t,html:r,text:a}){let n=process.env.BREVO_API_KEY;if(!n)return void console.warn("BREVO_API_KEY not set. Email not sent. Email would be:",{to:e,subject:t,html:r});let i=(process.env.EMAIL_FROM||"Family Vault <noreply@familyvault.app>").match(/^(.+?)\s*<(.+)>$|^(.+)$/),s=i?.[1]?.trim()||i?.[3]?.trim()||"Family Vault",o=i?.[2]?.trim()||i?.[3]?.trim()||"noreply@familyvault.app",l=await fetch("https://api.brevo.com/v3/smtp/email",{method:"POST",headers:{"Content-Type":"application/json","api-key":n},body:JSON.stringify({sender:{name:s,email:o},to:[{email:e}],subject:t,htmlContent:r,textContent:a})});if(!l.ok){let e=await l.json().catch(()=>({message:l.statusText}));throw Error(`Failed to send email: ${e.message||l.statusText}`)}return l.json()}async function w({to:e,invitationToken:t,role:r,familyName:a,inviterName:n}){let i=process.env.NEXT_PUBLIC_APP_URL;i||(i=process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000");let s=`${i}/auth/signup?token=${t}`,o="admin"===r?"Admin":"editor"===r?"Editor":"Member",l="admin"===r?"can manage the family account":"editor"===r?"can update account data":"can view the data",d=`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Family Vault Invitation</title>
    </head>
    <body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;">
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px 10px 0 0; text-align: center;">
        <h1 style="color: white; margin: 0; font-size: 28px;">Family Vault</h1>
      </div>
      
      <div style="background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; border: 1px solid #e5e7eb; border-top: none;">
        <h2 style="color: #111827; margin-top: 0;">You've been invited!</h2>
        
        <p style="font-size: 16px; color: #4b5563;">
          <strong>${n}</strong> has invited you to join <strong>${a}</strong> on Family Vault.
        </p>
        
        <div style="background: white; border-left: 4px solid #667eea; padding: 15px; margin: 20px 0; border-radius: 4px;">
          <p style="margin: 0; color: #374151;">
            <strong>Your Role:</strong> ${o}<br>
            <span style="font-size: 14px; color: #6b7280;">${l}</span>
          </p>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
          <a href="${s}" 
             style="display: inline-block; background: #667eea; color: white; padding: 14px 28px; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 16px;">
            Accept Invitation
          </a>
        </div>
        
        <p style="font-size: 14px; color: #6b7280; margin-top: 30px;">
          Or copy and paste this link into your browser:<br>
          <a href="${s}" style="color: #667eea; word-break: break-all;">${s}</a>
        </p>
        
        <p style="font-size: 12px; color: #9ca3af; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
          This invitation will expire in 30 days. If you didn't expect this invitation, you can safely ignore this email.
        </p>
      </div>
    </body>
    </html>
  `,u=`
You've been invited to join ${a} on Family Vault!

${n} has invited you with the role: ${o} (${l})

Accept your invitation by clicking this link:
${s}

This invitation will expire in 30 days.
  `.trim();return R({to:e,subject:`You've been invited to join ${a} on Family Vault`,html:d,text:u})}async function b(e){try{let t=await (0,g.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return y.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),n=a.get("familyId");if(!n)return y.NextResponse.json({error:"Missing familyId"},{status:400});let{data:i}=await t.from("family_users").select("role").eq("family_id",n).eq("user_id",r.id).single();if(i?.role!=="admin")return y.NextResponse.json({error:"Unauthorized - Admin access required"},{status:403});let{data:s,error:o}=await t.from("invitations").select("*").eq("family_id",n).order("created_at",{ascending:!1});if(o)return y.NextResponse.json({error:o.message},{status:500});return y.NextResponse.json({success:!0,data:s||[]})}catch(e){return console.error("Error fetching invitations:",e),y.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}async function E(e){try{let t=await (0,g.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return y.NextResponse.json({error:"Unauthorized"},{status:401});let{email:a,role:n,familyId:i}=await e.json();if(!a||!n||!i)return y.NextResponse.json({error:"Missing required fields"},{status:400});let{data:s}=await t.from("family_users").select("role").eq("family_id",i).eq("user_id",r.id).single();if(s?.role!=="admin")return y.NextResponse.json({error:"Unauthorized - Admin access required"},{status:403});let{data:o}=await t.from("invitations").select("id").eq("family_id",i).eq("email",a.toLowerCase().trim()).eq("status","pending").maybeSingle();if(o)return y.NextResponse.json({error:"Invitation already exists",message:"A pending invitation already exists for this email."},{status:409});let{data:l,error:d}=await t.from("invitations").insert({family_id:i,email:a.toLowerCase().trim(),role:n,invited_by:r.id,status:"pending"}).select().single();if(d)return y.NextResponse.json({error:d.message},{status:500});let{data:u}=await t.from("families").select("family_name, main_user").eq("id",i).single(),p=u?.family_name||u?.main_user||"your family";try{await w({to:a.toLowerCase().trim(),invitationToken:l.token,role:n,familyName:p,inviterName:r.email||"Family Admin"})}catch(e){console.error("Error sending invitation email:",e)}return y.NextResponse.json({success:!0,data:l})}catch(e){return console.error("Error creating invitation:",e),y.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}async function _(e){try{let t=await (0,g.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return y.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),n=a.get("id");if(!n)return y.NextResponse.json({error:"Missing invitation id"},{status:400});let{data:i}=await t.from("invitations").select("family_id").eq("id",n).single();if(!i)return y.NextResponse.json({error:"Invitation not found"},{status:404});let{data:s}=await t.from("family_users").select("role").eq("family_id",i.family_id).eq("user_id",r.id).single();if(s?.role!=="admin")return y.NextResponse.json({error:"Unauthorized - Admin access required"},{status:403});let{error:o}=await t.from("invitations").delete().eq("id",n);if(o)return y.NextResponse.json({error:o.message},{status:500});return y.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting invitation:",e),y.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}e.s(["DELETE",()=>_,"GET",()=>b,"POST",()=>E],9124);var C=e.i(9124);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/invitations/route",pathname:"/api/invitations",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/invitations/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:j,workUnitAsyncStorage:A,serverHooks:k}=N;function q(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:A})}async function T(e,t,a){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/invitations/route";g=g.replace(/\/index$/,"")||"/";let y=await N.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:w,nextConfig:b,parsedUrl:E,isDraftMode:_,prerenderManifest:C,routerServerContext:j,isOnDemandRevalidate:A,revalidateOnlyGenerated:k,resolvedPathname:q,clientReferenceManifest:T,serverActionsManifest:P}=y,U=(0,o.normalizeAppPath)(g),I=!!(C.dynamicRoutes[U]||C.routes[q]),O=async()=>((null==j?void 0:j.render404)?await j.render404(e,t,E,!1):t.end("This page could not be found"),null);if(I&&!_){let e=!!C.routes[q],t=C.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await O();throw new f.NoFallbackError}}let $=null;!I||N.isDev||_||($="/index"===($=q)?"/":$);let S=!0===N.isDev||!I,F=I&&!S;P&&T&&(0,s.setManifestsSingleton)({page:g,clientReferenceManifest:T,serverActionsManifest:P});let M=e.method||"GET",H=(0,i.getTracer)(),L=H.getActiveScopeSpan(),D={params:w,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:S,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>N.onRequestError(e,t,a,n,j)},sharedContext:{buildId:R}},V=new l.NodeNextRequest(e),z=new l.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(V,(0,d.signalFromNodeResponse)(t));try{let s=async e=>N.handle(K,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${g}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&A&&k&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=D.renderOpts.fetchMetrics;let l=D.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=D.renderOpts.collectedTags;if(!I)return await (0,c.sendResponse)(V,z,i,D.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[x.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,a=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:A})},!1,j),t}},u=await N.handleResponse({req:e,nextConfig:b,cacheKey:$,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:k,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!I)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&I||f.delete(x.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,c.sendResponse)(V,z,new Response(u.value.body,{headers:f,status:u.value.status||200})),null};L?await l(L):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${g}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:A})},!1,j),I)throw t;return await (0,c.sendResponse)(V,z,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>q,"routeModule",()=>N,"serverHooks",()=>k,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>A],91846)},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__746ed433._.js.map