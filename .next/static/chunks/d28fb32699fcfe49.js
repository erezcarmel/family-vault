(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87179,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(20755),i=e.i(49721),l=e.i(68757);function r({isOpen:e,onClose:r,onSuccess:n,familyId:o,document:d}){let[c,m]=(0,s.useState)(""),[x,u]=(0,s.useState)(""),[h,f]=(0,s.useState)(null),[p,g]=(0,s.useState)(!1),[y,b]=(0,s.useState)(0),j=(0,s.useRef)(null),w=(0,a.createClient)();(0,s.useEffect)(()=>{d?(m(d.title),u(d.description||""),f(null)):N()},[d,e]);let N=()=>{m(""),u(""),f(null),b(0),j.current&&(j.current.value="")},v=async e=>{if(e.preventDefault(),!o)return void alert("Family ID not found");if(!c.trim())return void alert("Please enter a title");if(d)return void await F();if(!h)return void alert("Please select a file to upload");g(!0),b(0);try{let{data:{user:e}}=await w.auth.getUser();if(!e)throw Error("User not found");let t=h.name.split(".").pop(),s=`${Date.now()}-${Math.random().toString(36).substring(2)}.${t}`,a=`${e.id}/${s}`,{error:i}=await w.storage.from("family-documents").upload(a,h,{cacheControl:"3600",upsert:!1});if(i)throw i;b(50);let{error:l}=await w.from("documents").insert({family_id:o,title:c.trim(),description:x.trim()||null,file_name:h.name,file_path:a,file_size:h.size,file_type:h.type||"application/octet-stream"});if(l)throw await w.storage.from("family-documents").remove([a]),l;b(100),n(),N()}catch(e){console.error("Error uploading document:",e),alert(`Failed to upload document: ${e.message}`)}finally{g(!1),b(0)}},F=async()=>{if(d){g(!0);try{let{error:e}=await w.from("documents").update({title:c.trim(),description:x.trim()||null,updated_at:new Date().toISOString()}).eq("id",d.id);if(e)throw e;n(),N()}catch(e){console.error("Error updating document:",e),alert(`Failed to update document: ${e.message}`)}finally{g(!1)}}};return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-white/75 z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:d?"Edit Document Details":"Upload Document"}),(0,t.jsx)("button",{onClick:r,disabled:p,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faTimes,className:"text-xl"})})]}),(0,t.jsxs)("form",{onSubmit:v,className:"p-6 space-y-6",children:[!d&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File *"}),(0,t.jsx)("input",{ref:j,type:"file",onChange:e=>{let t=e.target.files?.[0];if(t){if(t.size>0x3200000)return void alert("File size must be less than 50MB");f(t)}},className:"hidden",disabled:p}),h?(0,t.jsx)("div",{className:"border-2 border-indigo-200 bg-indigo-50 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faFile,className:"text-indigo-600 text-2xl"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:h.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]})(h.size)})]})]}),!p&&(0,t.jsx)("button",{type:"button",onClick:()=>{f(null),j.current&&(j.current.value="")},className:"text-red-600 hover:text-red-700",children:(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faTimes})})]})}):(0,t.jsxs)("button",{type:"button",onClick:()=>j.current?.click(),disabled:p,className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 hover:bg-indigo-50 transition-colors disabled:opacity-50",children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faUpload,className:"text-4xl text-gray-400 mb-3"}),(0,t.jsx)("p",{className:"text-gray-700 font-medium",children:"Click to select a file"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Max file size: 50MB"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>m(e.target.value),className:"input-field",placeholder:"e.g., Passport Copy, House Insurance Policy",required:!0,disabled:p,maxLength:200}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/200 characters"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),(0,t.jsx)("textarea",{value:x,onChange:e=>u(e.target.value),className:"input-field min-h-[100px]",placeholder:"Add any additional details or notes about this document...",disabled:p,maxLength:1e3,rows:4}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[x.length,"/1000 characters"]})]}),p&&(0,t.jsxs)("div",{className:"bg-indigo-50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-indigo-900",children:d?"Updating...":"Uploading..."}),(0,t.jsxs)("span",{className:"text-sm text-indigo-700",children:[y,"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-indigo-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[(0,t.jsx)("button",{type:"button",onClick:r,disabled:p,className:"flex-1 btn-secondary disabled:opacity-50",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:p||!c.trim()||!d&&!h,className:"flex-1 btn-primary disabled:opacity-50",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faSpinner,className:"mr-2 animate-spin"}),d?"Updating...":"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:d?l.faTimes:l.faUpload,className:"mr-2"}),d?"Update Details":"Upload Document"]})})]})]})]})}):null}function n(){let[e,n]=(0,s.useState)([]),[o,d]=(0,s.useState)(null),[c,m]=(0,s.useState)(!0),[x,u]=(0,s.useState)(!1),[h,f]=(0,s.useState)(null),[p,g]=(0,s.useState)(null),y=(0,a.createClient)();(0,s.useEffect)(()=>{b()},[]);let b=async()=>{try{let{data:{user:e}}=await y.auth.getUser();if(e){let{data:t}=await y.from("families").select("id").eq("user_id",e.id).single();t&&(d(t.id),await j(t.id))}}catch(e){console.error("Error loading data:",e)}finally{m(!1)}},j=async e=>{let{data:t,error:s}=await y.from("documents").select("*").eq("family_id",e).order("created_at",{ascending:!1});s?console.error("Error loading documents:",s):n(t||[])},w=async e=>{g(e.id);try{let{data:t,error:s}=await y.storage.from("family-documents").download(e.file_path);if(s)throw s;let a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=e.file_name,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i)}catch(e){console.error("Error downloading document:",e),alert("Failed to download document. Please try again.")}finally{g(null)}},N=async e=>{if(confirm(`Are you sure you want to delete "${e.title}"?`))try{let{error:t}=await y.storage.from("family-documents").remove([e.file_path]);if(t)throw t;let{error:s}=await y.from("documents").delete().eq("id",e.id);if(s)throw s;o&&await j(o)}catch(e){console.error("Error deleting document:",e),alert("Failed to delete document. Please try again.")}},v=()=>{f(null),u(!0)},F=()=>{u(!1),f(null)};return c?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faFileAlt,className:"text-white text-xl"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Documents"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Upload and manage your important documents"})]})]}),(0,t.jsxs)("button",{onClick:v,className:"btn-primary",children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faPlus,className:"mr-2"}),"Upload Document"]})]}),0===e.length?(0,t.jsxs)("div",{className:"text-center py-12 card",children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faFileAlt,className:"text-6xl text-gray-300 mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Documents Yet"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Start by uploading your first document"}),(0,t.jsxs)("button",{onClick:v,className:"btn-primary",children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faPlus,className:"mr-2"}),"Upload Your First Document"]})]}):(0,t.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>{var s;return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-3xl",children:(s=e.file_type).startsWith("image/")?"ðŸ–¼ï¸":s.startsWith("video/")?"ðŸŽ¥":s.startsWith("audio/")?"ðŸŽµ":s.includes("pdf")?"ðŸ“„":s.includes("word")||s.includes("document")?"ðŸ“":s.includes("excel")||s.includes("spreadsheet")?"ðŸ“Š":s.includes("powerpoint")||s.includes("presentation")?"ðŸ“½ï¸":s.includes("zip")||s.includes("rar")||s.includes("compressed")?"ðŸ“¦":"ðŸ“„"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]})(e.file_size)})]})]})}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",title:e.file_name,children:e.file_name}),(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(e.created_at).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-gray-100",children:[(0,t.jsx)("button",{onClick:()=>w(e),disabled:p===e.id,className:"flex-1 text-sm px-3 py-2 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:p===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faSpinner,className:"animate-spin"}),(0,t.jsx)("span",{children:"Downloading..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faDownload}),(0,t.jsx)("span",{children:"Download"})]})}),(0,t.jsx)("button",{onClick:()=>{f(e),u(!0)},className:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",title:"Edit details",children:(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faEdit})}),(0,t.jsx)("button",{onClick:()=>N(e),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors",title:"Delete",children:(0,t.jsx)(i.FontAwesomeIcon,{icon:l.faTrash})})]})]},e.id)})}),(0,t.jsx)(r,{isOpen:x,onClose:F,onSuccess:()=>{o&&j(o),F()},familyId:o,document:h})]})}e.s(["default",()=>n,"dynamic",0,"force-dynamic"],87179)}]);