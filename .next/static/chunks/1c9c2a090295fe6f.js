(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,22551,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(20755),l=e.i(49721),i=e.i(68757),r=e.i(98484);function n(){let[e,n]=(0,s.useState)([]),[o,c]=(0,s.useState)([]),[d,m]=(0,s.useState)(null),[x,u]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0),[f,p]=(0,s.useState)(!1),[j,b]=(0,s.useState)(!1),[y,v]=(0,s.useState)(null),[N,w]=(0,s.useState)({email:"",role:"member"}),[C,A]=(0,s.useState)({email:"",role:"member"}),[k,F]=(0,s.useState)(null),E=(0,t.createClient)(),I=[{value:"admin",label:"Admin",icon:i.faShieldAlt,description:"Can manage the family account"},{value:"editor",label:"Editor",icon:i.faUserEdit,description:"Can update account data, cannot manage members"},{value:"member",label:"Member",icon:i.faUser,description:"Can only view the data"}];(0,s.useEffect)(()=>{U()},[]);let U=async()=>{try{let{data:{user:e}}=await E.auth.getUser();if(e){let e=await (0,r.getFamilyId)(E);if(console.log("Users page - Family ID:",e),e){m(e);let a=await (0,r.getUserRole)(E,e);console.log("Users page - User role:",a),u(a),"admin"===a?(await S(e),await T(e)):F(`You do not have permission to manage users. Your role: ${a||"none"}`)}else F("No family found. Please complete onboarding first.")}}catch(e){console.error("Error loading data:",e),F(`Failed to load user data: ${e instanceof Error?e.message:"Unknown error"}`)}finally{g(!1)}},S=async e=>{let{data:a,error:s}=await E.from("family_users").select("*").eq("family_id",e).order("created_at",{ascending:!1});if(s){console.error("Error loading users:",s),F("Failed to load users");return}n(await Promise.all((a||[]).map(async e=>{let a=await fetch(`/api/get-user-email?userId=${e.user_id}`),s=await a.json();return{...e,email:s.email||"Unknown"}})))},T=async e=>{let a=await fetch(`/api/invitations?familyId=${e}`),s=await a.json();s.success&&c(s.data||[])},P=async e=>{if(e.preventDefault(),F(null),d)try{let e=await fetch("/api/invitations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:C.email,role:C.role,familyId:d})}),a=await e.json();if(!e.ok)throw Error(a.message||a.error||"Failed to create invitation");await T(d),A({email:"",role:"member"}),b(!1)}catch(e){console.error("Error creating invitation:",e),F(e.message||"Failed to create invitation")}},R=async e=>{if(confirm("Are you sure you want to cancel this invitation?"))try{if(!(await fetch(`/api/invitations?id=${e}`,{method:"DELETE"})).ok)throw Error("Failed to delete invitation");d&&await T(d)}catch(e){console.error("Error deleting invitation:",e),alert("Failed to cancel invitation")}},$=async e=>{if(e.preventDefault(),F(null),d)try{if(y){let{error:e}=await E.from("family_users").update({role:N.role}).eq("id",y.id);if(e)throw e}else{let e=await fetch("/api/add-family-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:N.email,role:N.role,familyId:d})}),a=await e.json();if(!e.ok)throw Error(a.message||a.error||"Failed to add user")}await S(d),w({email:"",role:"member"}),p(!1),v(null)}catch(e){console.error("Error saving user:",e),F(e.message||"Failed to save user")}},q=async e=>{if(confirm("Are you sure you want to remove this user from your family?"))try{let{error:a}=await E.from("family_users").delete().eq("id",e);if(a)throw a;d&&await S(d)}catch(e){console.error("Error deleting user:",e),alert("Failed to remove user")}},O=e=>{let a=I.find(a=>a.value===e);return a?.label||e};return h?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):"admin"!==x?(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"card text-center py-12",children:[(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faShieldAlt,className:"text-6xl text-gray-300 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600",children:"You need admin permissions to manage users."})]})}):(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faUsers,className:"text-white text-xl"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage family members and their permissions"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{b(!j),p(!1),A({email:"",role:"member"}),F(null)},className:"btn-secondary",children:[(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faEnvelope,className:"mr-2"}),"Invite User"]}),(0,a.jsxs)("button",{onClick:()=>{p(!f),b(!1),v(null),w({email:"",role:"member"}),F(null)},className:"btn-primary",children:[(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faPlus,className:"mr-2"}),"Add User"]})]})]}),k&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:k}),j&&(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Invite Family Member"}),(0,a.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",value:C.email,onChange:e=>A({...C,email:e.target.value}),className:"input-field",placeholder:"user@example.com",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"They will receive an invitation link to sign up"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,a.jsx)("select",{value:C.role,onChange:e=>A({...C,role:e.target.value}),className:"input-field",required:!0,children:I.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:I.find(e=>e.value===C.role)?.description})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{b(!1),A({email:"",role:"member"}),F(null)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:"Send Invitation"})]})]})]}),f&&(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:y?"Edit User Role":"Add Family Member"}),(0,a.jsxs)("form",{onSubmit:$,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",value:N.email,onChange:e=>w({...N,email:e.target.value}),className:"input-field",placeholder:"user@example.com",required:!0,disabled:!!y}),y&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),(0,a.jsx)("select",{value:N.role,onChange:e=>w({...N,role:e.target.value}),className:"input-field",required:!0,children:I.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:I.find(e=>e.value===N.role)?.description})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{p(!1),v(null),w({email:"",role:"member"}),F(null)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:y?"Update Role":"Add User"})]})]})]}),o.length>0&&(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pending Invitations"}),(0,a.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(l.FontAwesomeIcon,{icon:"pending"===e.status?i.faClock:"accepted"===e.status?i.faCheckCircle:i.faTimesCircle,className:`text-lg ${"pending"===e.status?"text-yellow-600":"accepted"===e.status?"text-green-600":"text-gray-400"}`}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.email}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Role: ",O(e.role)," â€¢","pending"===e.status?(0,a.jsx)("span",{className:"text-yellow-600",children:" Pending"}):"accepted"===e.status?(0,a.jsx)("span",{className:"text-green-600",children:" Accepted"}):(0,a.jsxs)("span",{className:"text-gray-400",children:[" ",e.status]})]}),"pending"===e.status&&(0,a.jsx)("button",{onClick:()=>{var a;let s,t;return a=e.token,s=window.location.origin,t=`${s}/auth/signup?token=${a}`,void(navigator.clipboard.writeText(t),alert("Invitation link copied to clipboard!"))},className:"text-xs text-indigo-600 hover:text-indigo-700 mt-1",children:"Copy invitation link"})]})]})}),"pending"===e.status&&(0,a.jsx)("button",{onClick:()=>R(e.id),className:"text-red-600 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Cancel invitation",children:(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faTrash})})]},e.id))})]}),0===e.length?(0,a.jsxs)("div",{className:"text-center py-12 card",children:[(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faUsers,className:"text-6xl text-gray-300 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Users Yet"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Add family members to share access"}),(0,a.jsxs)("button",{onClick:()=>p(!0),className:"btn-primary",children:[(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faPlus,className:"mr-2"}),"Add Your First User"]})]}):(0,a.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(s=>{var t;let r;return(0,a.jsx)("div",{className:"card hover:shadow-lg transition-shadow",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center",children:(0,a.jsx)(l.FontAwesomeIcon,{icon:(t=s.role,r=I.find(e=>e.value===t),r?.icon||i.faUser),className:"text-white text-xl"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s.email}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:O(s.role)})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:I.find(e=>e.value===s.role)?.description})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("button",{onClick:()=>{v(s),w({email:s.email||"",role:s.role}),p(!0)},className:"text-indigo-600 hover:text-indigo-700 p-2 rounded-lg hover:bg-indigo-50 transition-colors",title:"Edit role",children:(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faEdit})}),e.length>1&&(0,a.jsx)("button",{onClick:()=>q(s.id),className:"text-red-600 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Remove user",children:(0,a.jsx)(l.FontAwesomeIcon,{icon:i.faTrash})})]})]})},s.id)})})]})}e.s(["default",()=>n,"dynamic",0,"force-dynamic"])}]);